<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.moira.itda.domain.admin.code.mapper.AdminCodeMapper">
    <!-- 어드민 페이지 > 공통코드 > 등록 > codeKey 존재 여부 확인 -->
    <select id="selectCodeKeyChk">
        SELECT COUNT(code_key) FROM COMMON_CODE WHERE code_key = #{codeKey}
    </select>

    <!-- 어드민 페이지 > 공통코드 > 등록 > CommonCode 저장 -->
    <insert id="insertCommonCode">
        INSERT INTO COMMON_CODE (
               code_key
             , created_at
             , updated_at
        )
        VALUES (
               #{codeKey}
             , #{createdAt}
             , #{updatedAt}
        )
    </insert>

    <!-- 어드민 페이지 > 공통코드 > 세부코드 등록 > engName 존재 여부 확인 -->
    <select id="selectEngNameChk">
        SELECT COUNT(id) FROM COMMON_CODE_DETAIL WHERE eng_name = #{engName}
    </select>

    <!-- 어드민 페이지 > 공통코드 > 세부코드 등록 > CommonCodeDetail 저장 -->
    <insert id="insertCommonCodeDetail">
        INSERT INTO COMMON_CODE_DETAIL (
               code_key
             , eng_name
             , kor_name
             , created_at
             , updated_at
        )
        VALUES (
               #{codeKey}
             , #{engName}
             , #{korName}
             , #{createdAt}
             , #{updatedAt}
        )
    </insert>

    <!-- 어드민 페이지 > 공통코드 > 전체 조회 -->
    <select id="selectCommonCodeList" resultType="com.moira.itda.domain.admin.code.dto.response.AdminCodeResponse">
        SELECT
               code_key
             , created_at
             , updated_at
        FROM COMMON_CODE
        ORDER BY code_key ASC
    </select>

    <!-- 어드민 페이지 > 공통코드 > 세부코드 목록 조회 -->
    <select id="selectCommonCodeDetailList" resultType="com.moira.itda.domain.admin.code.dto.response.AdminCodeDetailResponse">
        SELECT
               id AS detailId
             , eng_name
             , kor_name
             , created_at
             , updated_at
        FROM COMMON_CODE_DETAIL
        WHERE code_key = #{key}
        ORDER BY created_at ASC
    </select>

    <!-- 어드민 페이지 > 공통코드 > 세부코드 수정 > engName 존재 여부 확인 -->
    <select id="selectEngNameChk2">
        SELECT COUNT(id) FROM COMMON_CODE_DETAIL WHERE eng_name = #{engName} AND id != #{detailId}
    </select>

    <!-- 어드민 페이지 > 공통코드 > 세부코드 수정 > CommonCodeDetail 수정 -->
    <update id="updateCommonCodeDetail">
        UPDATE COMMON_CODE_DETAIL
        SET
               eng_name = #{request.engName}
             , kor_name = #{request.korName}
        WHERE code_key = #{key}
         AND  id       = #{detailId}
    </update>

    <!-- 어드민 페이지 > 공통코드 > CommonCode 삭제 -->
    <delete id="deleteCommonCode">
        DELETE FROM COMMON_CODE WHERE code_key = #{key}
    </delete>

    <!-- 어드민 페이지 > 공통코드 > CommonCodeDetail 전체 삭제 -->
    <delete id="deleteCommonCodeDetailList">
        DELETE FROM COMMON_CODE_DETAIL WHERE code_key = #{key}
    </delete>

    <!-- 어드민 페이지 > 공통코드 > CommonCodeDetail 삭제 -->
    <delete id="deleteCommonCodeDetail">
        DELETE FROM COMMON_CODE_DETAIL WHERE code_key = #{key} AND id = #{detailId}
    </delete>
</mapper>