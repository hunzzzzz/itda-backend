<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.moira.itda.domain.notification.mapper.NotificationMapper">
    <!-- 알림 전송 > Notification 저장 -->
    <insert id="insertNotification">
        INSERT INTO NOTIFICATION (
               receiver_id
             , sender_id
             , type
             , content
             , target_id
             , read_yn
             , created_at
        )
        VALUES (
               #{receiverId}
             , #{senderId}
             , #{type}
             , #{content}
             , #{targetId}
             , #{readYn}
             , #{createdAt}
        )
    </insert>

    <!-- 알림목록 조회 > totalElements 계산 -->
    <select id="selectNotificationListCnt" resultType="java.lang.Long">
        SELECT COUNT(id) FROM NOTIFICATION WHERE receiver_id = #{userId}
    </select>

    <!-- 알림목록 조회 -->
    <select id="selectNotificationList" resultType="com.moira.itda.domain.notification.dto.response.NotificationResponse">
        SELECT
               N.id          AS notification_id
             , N.sender_id
             , U.nickname    AS sender_nickname
             , N.type
             , N.content
             , N.target_id
             , N.read_yn
             , N.created_at
        FROM NOTIFICATION N
         INNER JOIN USER U ON U.id = N.sender_id
        WHERE N.receiver_id = #{userId}
        ORDER BY N.created_at DESC
        LIMIT #{pageSize} OFFSET #{offset}
    </select>
</mapper>