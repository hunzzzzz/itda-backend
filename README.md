# 🎡 ITDA (잇다)

### "가챠(Gacha) 덕후들을 위한 교환 및 직거래 플랫폼"

![Version](https://img.shields.io/badge/version-1.0.0-blue?style=flat-square)
[![Domain](https://img.shields.io/badge/Domain-itda.lovable.app-FF6B6B?style=flat-square)](https://itda.lovable.app/)

> **⚠️ 안내사항 (Service Notification)**
>
> 현재 ITDA는 기능 점검 및 데이터 피드백을 위한 **베타 서버(Beta)**를 운영 중입니다.
> 현재 도메인에서는 테스트 목적의 기능 이용이 가능하며, **v1.2.0 업데이트**와 함께 정식 도메인 배포 및 데이터 마이그레이션이 진행될 예정입니다.

---

## 📖 서비스 배경 (Introduction)

> **"내가 뽑고 싶은 건 이게 아닌데... 왜 또 너야? 😂"**

가챠(캡슐 토이)를 즐기다 보면 누구나 원치 않는 아이템을 얻거나, 같은 아이템이 중복으로 나오는 상황을 마주합니다. 하지만 이를 교환하거나 판매할 적당한 공간을 찾기란 쉽지 않습니다. **당근마켓이나 번개장터와
같은 기존 플랫폼은 도메인이 너무 방대하여** 특정 가챠 시리즈의 세부 라인업을 일일이 확인하기 어렵고, 일반 커뮤니티 게시판은 체계적인 거래 프로세스가 없어 미입금이나 분쟁 등 신뢰를 담보하기 어렵기 때문입니다.

**ITDA(잇다)**는 이러한 가챠 '덕후'들의 불편함에서 시작되었습니다. 단순한 정보 공유를 넘어, 정교한 가챠 데이터베이스를 기반으로 유저와 유저를 잇고, 수집의 즐거움을 완성하는 전용 거래 플랫폼을
지향합니다.

---

## 🚀 핵심 가치

* **나만의 가챠 수집 히스토리:** 가챠 시리즈별 하위 아이템 정보를 바탕으로 본인이 획득한 아이템을 기록하고 공개 데이터로 누적합니다. 유저는 이를 통해 자신의 수집 현황을 관리하고, 타 유저는 해당 데이터를
  참고하여 거래 가능 여부를 판단하는 지표로 활용합니다.
* **위치 기반 스마트 거래:** 자주 활동하는 장소를 'MY PLACE'로 저장하여 해당 지점 반경 5km 이내의 거래글을 조회할 수 있습니다. 장소 이동이 잦은 유저들도 언제 어디서든 거래를 시작할 수
  있습니다.
* **타겟팅 위시리스트:** 내가 간절히 원하는 위시 아이템이 포함된 거래글만 필터링하여 실시간으로 확인하고, 즉각적인 교환 및 구매 제안이 가능합니다.
* **상태 중심의 안전 거래 시스템:** '판매 등록 - 제안 - 승인 - 채팅 - 완료'로 이어지는 거래의 전 과정을 시스템 **'상태(Status)'**값으로 엄격하게 관리합니다. 승인된 사용자만 채팅방에
  진입하도록 제한하고, 거래 진행 중에는 게시글 삭제를 방지하는 등 논리적 제약 조건을 통해 안전한 거래 환경을 보장합니다.
* **매너 점수와 커뮤니티 정화:** 거래 완료 후 상호 간의 '칭찬' 시스템을 통해 유저의 신뢰도를 시각화합니다. 또한 부적절한 유저는 '신고' 기능을 통해 관리자 검토 후 신속히 차단함으로써 건강하고 투명한
  거래 문화를 유지합니다.

---

## 📌 프로젝트 이력

| Version    | Period                  | Key Focus                                                                                                      |
|:-----------|:------------------------|:---------------------------------------------------------------------------------------------------------------|
| **v1.0.0** | 2025.12.16 ~ 2026.01.15 | • 상태 기반 거래 프로세스 설계 및 구현<br>• WebSocket을 이용한 실시간 거래 협상 시스템 구축<br>• 사용자 참여형 가챠 데이터 관리<br>• 기본적인 계정 및 유저 지원 기능 구현 |
| **v1.1.0** | 2026.01.25 ~ **개발중**    | • 토큰 재발급 로직 고도화<br>• 사용자 경험(UX) 개선을 위한 전체적인 UI/UX 리뉴얼<br>• WebSocket을 이용한 알림 서비스 제공                            |

---

## ⚙️ 기술 스택

### Backend & Database

- **Language**: Kotlin 1.9
- **Framework**: Spring Boot 3.x
- **ORM**: MyBatis
- **Database**: MySQL 8.0
- **Real-time**: Spring WebSocket, STOMP

### Security & Infrastructure

- **Authentication**: Spring Security, JWT (Access & Refresh Token)
- **Storage**: AWS S3
- **DevOps**: AWS EC2, Docker, GitHub Actions (CI/CD)
- **External API**: 휴대폰 본인 인증 서비스

---

## 📄 개발 문서

*프로젝트 설계 및 API 명세 관련 문서입니다. (URL 준비 중)*

- **[ERD]** [테이블 설계 내용을 명시한 ERD Cloud 바로가기](YOUR_ERD_URL)
- **[API Spec]** [API 명세서를 기록한 Notion 바로가기](YOUR_API_URL)
- **[Notion]** [프로젝트 상세 기능을 기록한 Notion 바로가기](YOUR_NOTION_URL)

---

## 🏗️ 프로젝트 아키텍처 (System Architecture)

### 1. 도메인 중심의 패키지 구조

ITDA는 비즈니스 로직의 응집도를 높이고 유지보수를 용이하게 하기 위해 **도메인 중심 패키지 구조**를 채택했습니다. 각 도메인(`User`, `Gacha`, `Trade`, `Chat` 등)은 자신의 책임에
집중하며, 서비스 확장 시 특정 도메인을 독립적인 모듈로 분리하기 용이한 구조를 가지고 있습니다.

### 2. 현재 배포 아키텍처

현재는 빠른 개발 속도와 초기 운영 효율성을 위해 **AWS EC2 단일 인스턴스 기반의 Monolithic Architecture**로 운영 중입니다.

- **Application**: Spring Boot 기반 단일 JAR 배포
- **Storage**: 정적 리소스(이미지) 처리를 위한 AWS S3 활용
- **CI/CD**: GitHub Actions와 Docker를 활용한 자동화 파이프라인 구축

### 3. 향후 수정 계획

서비스 트래픽 증가와 도메인별 트래픽 불균형에 대비하여, 향후 **마이크로서비스 아키텍처**로의 전환을 고려한 설계를 계획하고 있습니다.

- **Service Discovery**: 도메인 간 독립적 확장성 확보
- **Message Broker**: 도메인 간의 느슨한 결합(Loose Coupling)을 위한 이벤트 기반 아키텍처 도입 예정
- **Database Per Service**: 각 도메인의 특성에 최적화된 DB 분리 및 관리

---

## 📂 프로젝트 패키지 구조

(추후 업로드 예정)

---

## ✨ 주요 기능

### 🛠️ 1. 공통 기능 (Common)

* **휴대폰 본인 인증 시스템**
    * **1인 1계정 정책**: 중복 가입 및 사기 이용자의 재가입을 방지하기 위해 1인 1계정 원칙을 고수하며, 이를 위해 고유 식별값인 **CI(Connecting Information)** 기반의 식별
      시스템을 구축했습니다.
    * **자체 식별 로직**: 외부 인증 API(PASS 등)의 제약을 고려하여 **CoolSms**와 연동한 SMS 인증 방식을 채택했으며, 서버에서 생성한 UUID 기반 CI를 통해 보안성과 식별력을
      확보했습니다.
    * **보안 검증 프로세스**: 인증 코드 전송부터 최종 서비스 로직(회원가입, 비밀번호 변경 등) 완료까지 단계별 유효 시간(TTL) 관리 및 CI 검증을 통해 세션의 안전성을 보장합니다.

### 🖼️ 이미지 저장 및 최적화 (AWS S3)

* **중앙 집중형 스토리지 관리**: 클라우드 기반인 **AWS S3**를 활용하여 서버 인스턴스의 확장성에 유연하게 대응하고 데이터의 고가용성을 확보했습니다.
* **이미지 최적화 파이프라인**: `scrimage` 라이브러리를 통해 모든 업로드 이미지를 **1280x1280 리사이징** 및 **WebP 포맷**으로 일괄 변환 처리합니다.
    * **비용 효율성**: 원본 대비 파일 용량을 대폭 축소하여 S3 저장 및 데이터 전송 비용을 최적화했습니다.
    * **성능 향상**: 최적화된 포맷을 통해 클라이언트 앱 내 이미지 로딩 속도를 개선했습니다.
* **비동기 업로드 구조**: 고유 **file_id (UUID)** 발급 방식을 채택하여 이미지 업로드와 본문 게시글 작성을 분리했습니다. 이를 통해 API 응답 속도를 개선하고 파일 관리의 독립성을 높였습니다.

### 🔑 JWT 토큰 인증 및 무중단 재발급 시스템 구축

* **보안 강화 저장 전략**:
    * **Web**: **httpOnly 쿠키**에 RefreshToken을 저장하여 클라이언트 측 스크립트 기반 탈취 공격(XSS)을 원천 차단했습니다.
    * **Mobile**: 보안이 강화된 저장소를 활용하여 토큰을 안전하게 관리합니다.
* **무중단 토큰 갱신**:
    * AccessToken 만료 시 사용자에게 로그아웃을 강제하지 않고, 백엔드 필터와 프론트엔드 인터셉터의 협업을 통해 자동으로 토큰을 갱신합니다.
* **Multi-Platform 지원**: 동일한 재발급 API 내에서 쿠키 기반(Web)과 헤더 기반(Mobile) 추출 로직을 분기 처리하여 다중 플랫폼에 대응하는 유연한 인증 아키텍처를 설계했습니다.
* **Token Rotation**: 재발급 시 RefreshToken까지 새로 갱신하는 방식을 채택하여, 토큰 탈취 시 발생할 수 있는 보안 취약점을 최소화했습니다.

### 👤 2. 계정 서비스 (Account Services)

* **심플한 회원가입 프로세스**: 본인인증(SMS) 완료 시 즉시 가입이 가능하며, 가입 초기 허들을 낮추기 위해 **서버 기반 랜덤 닉네임 부여 시스템**을 채택했습니다.
* **보안 중심 인증 관리**: JWT(Access/Refresh Token) 체계를 구축하였으며, 로그아웃 시 서버와 클라이언트 양측의 세션 정보를 동시 파괴하여 무단 접근을 원천 차단합니다.
* **계정 복구 및 보호**: 본인 식별 정보(CI)를 활용한 비밀번호 재설정 기능을 통해 안전한 계정 복구 환경을 제공합니다.
* **마이페이지**: 사용자가 자신의 기본 정보를 확인하고, 프로피 사진, 닉네임, 비밀번호 등을 변경할 수 있는 기능을 제공합니다.
* **회원 탈퇴 (To-be)**: 사용자 편의를 위한 탈퇴 프로세스를 v1.2.0 버전에 구현할 예정입니다.

### 🎡 3. 가챠 데이터 관리 (Gacha Information)

* **복합 필터링 및 정렬 시스템**: **MyBatis 동적 쿼리**를 활용하여 최신순, 인기순(조회/즐겨찾기), 거래량순 등 유저 니즈에 맞춘 5가지 이상의 정렬 조건과 고도화된 통합 검색 기능을 제공합니다.
* **집단지성 기반 획득 통계**: 유저가 직접 기록한 가챠 획득 이력(Pick History)을 데이터화하여, 실제 뽑기 전 아이템별 **체감 획득 확률**을 참고할 수 있는 통계 지표를 생성합니다.
* **효율적인 데이터 페이징**: 대량의 가챠 데이터 로딩 시 성능 최적화를 위해 **오프셋 기반 페이지네이션**을 적용하고, 필요한 메타데이터(이미지, 통계)를 Join 및 서브쿼리로 효율적으로 병합 처리합니다.
* **조회수 및 즐겨찾기 관리**: 쿠키 기반의 조회수 중복 방지 로직과 가챠별 위시리스트 기능을 통해 개인화된 사용자 경험을 지원합니다.

### 🤝 4. 거래 프로세스 (Trade Lifecycle)

ITDA의 거래는 게시글 단위가 아닌 **개별 아이템(TradeItem) 단위**로 세밀하게 관리되며, 모든 과정은 상태(Status) 시스템을 통해 관리 및 추적됩니다.

### 1️⃣ 판매 및 교환글 등록
* **1:N 복합 등록**: 하나의 게시글(Trade) 내에 여러 개의 가챠 아이템(TradeItem)을 동시에 등록하여 거래 효율성을 높였습니다.
* **거래 수단 설정**: '직거래'와 '택배거래' 중 선택이 가능하며, 직거래 시 **카카오맵 API**를 연동하여 상세 위치를 지정하거나 기존 저장된 **MY PLACE** 거점을 즉시 불러올 수 있습니다.
* **독립적 상태 관리**: 등록된 모든 아이템은 `PENDING(거래 가능)` 상태로 시작하며, 각 아이템은 개별적으로 제안 및 완료 처리가 가능합니다.

### 2️⃣ 거래글 조회
사용자의 니즈에 맞는 아이템을 빠르게 찾을 수 있도록 3가지 핵심 필터링 기능을 제공합니다.
* **타겟 아이템 필터**: 특정 가챠 시리즈 내에서 본인이 간절히 원하는 **특정 아이템이 포함된 게시글**만 골라볼 수 있습니다.
* **위치 기반 필터 (MY PLACE)**: 현재 선택한 거점(MY PLACE) 기준 **반경 5km 이내**의 직거래 게시글만 필터링하여 불필요한 탐색 시간을 단축합니다.
* **거래 가능 여부 필터**: 이미 거래가 완료된 글을 제외하고, 현재 **즉시 거래가 가능한(PENDING)** 게시글만 선별하여 조회할 수 있습니다.

### 3️⃣ 상태값 기반 내 게시글 관리
데이터 무결성과 안전한 거래를 위해 엄격한 상태 관리 정책을 적용합니다.
* **게시글 보호 로직**: 제안이 진행 중이거나 거래가 완료된 아이템이 포함된 경우, 게시글의 수정 및 삭제를 제한하여 거래 신뢰도를 보장합니다.
* **자동 상태 동기화**:
  * 하위 모든 아이템의 상태가 '거래 완료' 혹은 '삭제'가 될 경우, 게시글 전체 상태가 자동으로 **'종료(ENDED)'** 처리됩니다.
* **자원 일괄 정리**: 게시글 삭제 시 관련 데이터(TradeSuggest, TradeItem)의 상태값을 동시 업데이트하며, AWS S3에 저장된 물리적 이미지 파일까지 함께 삭제하여 저장 공간을 효율적으로 관리합니다.

### 4️⃣ 거래 제안
단순한 수락을 넘어, 사용자의 니즈를 반영한 고도화된 제안 시스템을 지원합니다.
* **유연한 제안 방식**:
  * **구매 제안**: 판매 가격에 대한 **가격 네고** 여부를 포함하여 제안할 수 있습니다.
  * **교환 제안**: 판매자가 원하는 아이템 외에 사용자가 보유한 **다른 아이템으로 교환을 역제안**할 수 있습니다.
* **제안 유효성 검증**: 특정 아이템에 대해 유효한 제안(PENDING, APPROVED)이 이미 존재하는 경우, 중복 제안을 원천 차단하여 혼선을 방지합니다.

### 5️⃣ 제안 수락/거절/취소/삭제
* **제안 승인 및 채팅**: 판매자가 제안을 승인(`APPROVED`)하면, **WebSocket/STOMP** 기반의 실시간 채팅방이 자동 개설됩니다. 승인된 유저 간의 안전한 소통 환경을 보장합니다.
* **유연한 거절 및 재제안**: 제안이 거절(`REJECTED`)된 경우, 제안자는 내용을 수정하여 해당 아이템에 다시 제안을 보낼 수 있는 기회를 가집니다.
* **응답 전 선제 취소**: 제안자는 판매자가 확인하기 전(`PENDING`)에 자유롭게 제안을 취소할 수 있으며, 취소 시 판매자에게는 더 이상 노출되지 않도록 처리하여 불필요한 알림을 방지합니다.
* **개인화된 내역 정리**: 취소, 거절, 거래 중단된 제안 내역은 `DELETED` 처리를 통해 목록을 깔끔하게 관리할 수 있으며, 이는 데이터 무결성을 위해 상태값 변경 방식으로 관리됩니다.

### 7️⃣ 실시간 채팅 및 협상 (Real-time Chatting)
* **WebSocket & STOMP 메시징**: Spring WebSocket 기술을 활용하여 1:1 실시간 대화 기능을 구현했습니다. 메시지 송신 시 유저 인증 정보를 결합하여 보안성을 강화했습니다.
* **거래 중단 및 히스토리 관리**: 협상 결렬 시 언제든 거래를 취소할 수 있으며, 모든 취소 내역은 사유와 함께 시스템에 기록되어 안전한 거래 환경을 모니터링하는 지표로 활용됩니다.

### 8️⃣ 거래 확정 및 시스템 동기화 (Trade Completion)
거래의 최종 단계에서 데이터 무결성을 유지하기 위한 자동화 로직을 수행합니다.
* **상태 연쇄 업데이트**: 특정 아이템의 거래가 완료되면 시스템이 스스로 나머지 대기 중인 제안들을 정리(거절/취소)하여 판매자의 번거로움을 최소화합니다.
* **계층형 마감 시스템**:
  1. 개별 **제안** 및 **아이템** 상태를 '완료'로 변경
  2. 해당 게시글 내 모든 아이템이 처리되었는지 확인
  3. 조건 충족 시 전체 **거래글** 상태를 자동으로 '종료' 처리
* **비동기 알림 시스템**: 거래 완료 시 상대방에게 실시간 알림을 전송하여 일방적인 상태 조작을 방지하고 상호 신뢰도를 높였습니다.

### 9️⃣ 거래 완료 및 상호 평가 (Completion & Feedback)
거래의 마무리 단계에서 서로의 신뢰를 확인하고 기록합니다.
* **유저 칭찬 및 신뢰도 축적**: 거래 완료 후 상대방을 칭찬할 수 있으며, 누적된 칭찬 횟수는 프로필에 공개되어 타 유저가 거래를 결정하는 중요한 신뢰 지표가 됩니다.
* **커뮤니티 정화(신고)**: 비매너 유저에 대한 신고 시스템을 운영합니다. 관리자는 신고 내역과 채팅 로그를 기반으로 검토하여 계정 정지 등 실효성 있는 제재를 진행합니다.

### 🔔 실시간 알림 시스템 (Notification)
서비스 내 주요 이벤트 발생 시 비동기 알림을 통해 빠른 피드백을 제공합니다.
* **거래 생명주기 관리**: 제안 접수, 승인, 취소, 완료 등 거래의 전 과정에서 상대방에게 즉시 알림을 전송하여 지연 없는 거래를 지원합니다.
* **운영 피드백**: 문의사항 답변 완료 및 신고 처리 결과 등 관리자와의 소통 결과를 실시간으로 전달받을 수 있습니다.

### 🛡️ 클린 커뮤니티 및 유저 신고 (Report & Sanction)
건강한 거래 문화 조성을 위해 강력한 신고 및 제재 시스템을 운영합니다.
* **신고 검증 시스템**: 비매너 유저나 일방적 거래 중단 발생 시 신고가 가능하며, 관리자는 채팅 로그 확인을 통해 객관적으로 제재 여부를 판단합니다.
* **계정 이용 제한**: 운영 정책을 위반한 유저에 대해 어드민 시스템을 통한 기간제 계정 정지 처리를 지원합니다.
* **투명한 취소 사유 공유**: 거래 취소 시에는 명확한 취소 사유를 상대방에게 전달하여 불필요한 오해를 방지하고, 신고 시에는 정보 비공개 원칙을 통해 신고자를 보호합니다.
* 
### 💎 6. 사용자 경험 및 서비스 완성도 향상 (UX & Service Quality)

* **멀티 MY PLACE (카카오맵 API)**: 최대 5개의 거점 등록 및 **반경 5km 직거래 필터링**을 지원하여, 활동 반경이 넓은 유저에게 최적화된 맞춤형 매물 조회 환경을 제공합니다.
* **즉각적인 유저 신뢰 검증**: 별도의 페이지 이동 없이 상대방의 **거래 횟수, 칭찬 수, 제재 이력**을 확인할 수 있는 프로필 모달을 통해 안전하고 신속한 거래 의사결정을 돕습니다.
* **참여형 가챠 데이터베이스**: 유저가 직접 신규 가챠 정보를 제보하는 시스템을 통해 관리자와 유저가 **함께 성장시키는 자생적 데이터 생태계**를 구축했습니다.
* **체계적인 고객 피드백 루프**: 에러 리포트 및 가챠 등록 요청 등 세분화된 고객지원 카테고리를 운영하여 서비스의 품질을 지속적으로 개선하고 있습니다.

(작성 중)